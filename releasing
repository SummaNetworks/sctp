##
# Maven release will create tag with release version and push it to repository (see troubleshooting)
# Will change local version to develop and will commit develop version too.

#This way maven will asks for versions names:
>mvn release:prepare -Darguments="-Dmaven.test.skip=true"

#With inline configuration:
mvn -Dtag=TAG-VERSION release:prepare -DreleaseVersion=RELEASE-VERSION -DdevelopmentVersion=NEXT-SNAPSHOT-VERSION -Darguments="-Dmaven.test.skip=true"
#Ex:
>mvn -Dtag=2.0.16-SUMMA-1.0.0 release:prepare -DreleaseVersion=2.0.16-SUMMA-1.0.0 -DdevelopmentVersion=2.0.16-SUMMA-1.0.1-SNAPSHOT -Darguments="-Dmaven.test.skip=true"


#Will download TAG to compile and generate artifact. Then will upload artifacts to repositories:
>mvn release:perform -Darguments="-Dgpg.skip -Dmaven.test.skip=true"


## If fail and is needed to repeat:
#Delete tag just created:
>git tag -d TagName
# En remoto si se ha hecho el push
>git push summa :TagName

#Rollback changes (not needed if pom has to not change)
mvn release:rollback

#Troubleshooting:
#Tags is created before remove SNAPSHOT, execute next in client:
>git config --add status.displayCommentPrefix true
#If while release:prepare using credential from server.xml maven return error while git-push operation:
#fatal: unable to access 'https://myUser:myPassword@github.com/SummaNetworks/sctp.git/': gnutls_handshake() failed: An unexpected TLS packet was received.
>git config --global http.sslVerify false
#If previous doesn't work, try to scape username and password in setting.xml, for example, replace @ by %40, and ! by %21.
#If upload snapshot instead of release:
>git config --global status.displayCommentPref

## Se supone que deberia poder leer las credenciales del setting.xml en .m2 pero no conecta bien, un error del TLS.
# Ademas hay que incluir la propiedad project.scm.id con el valor del id usado en el xml.
<settings>
   <servers>
      <server>
         <id>git-server</id>
         <username>myUser</username>
         <password>myPassword</password>
      </server>
   </servers>
</settings>


## Integracion con Jenkins:
# Debido a bug entre el plugin de release y el git, en lugar de desplegar release, despliega snapshots.
# Para solucionarlo hay que configurar el git con:
>git config --global status.displayCommentPref
# Que en el caso del jeknins, lo pondremos como "Pre Step"
# Despues de este cambio es posible que al sacar la release aparezca el error:
Detecting the current branch failed: fatal: ref HEAD is not a symbolic ref
# seguramente es porque estamos en releando una rama por lo que aÃ±adiremos el "Aditional Behaviours -> Checkout to specific local branch" y seleccionamos la rama que estamos releseando.

